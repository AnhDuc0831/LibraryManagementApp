<Window x:Class="LibraryManageApp.StudentWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Student Portal - Library System" Height="750" Width="1200"
        Background="#F0F4F8"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <!-- Style cho Button -->
        <Style x:Key="PrimaryButton" TargetType="Button">
            <Setter Property="Background" Value="#4299E1"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="6"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                BorderBrush="{TemplateBinding BorderBrush}">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#3182CE"/>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Background" Value="#2C5282"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="IconButton" TargetType="Button" BasedOn="{StaticResource PrimaryButton}">
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="MinWidth" Value="40"/>
        </Style>

        <Style x:Key="FloatingButton" TargetType="Button">
            <Setter Property="Background" Value="#4299E1"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="15"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="25"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                BorderBrush="{TemplateBinding BorderBrush}">
                            <Border.Effect>
                                <DropShadowEffect Color="#2C5282" Opacity="0.4" BlurRadius="20" ShadowDepth="5"/>
                            </Border.Effect>
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"
                                            Margin="{TemplateBinding Padding}"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#3182CE"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Style cho TextBox -->
        <Style x:Key="ModernTextBox" TargetType="TextBox">
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="BorderBrush" Value="#B3D4E5"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="#2C5282"/>
            <Style.Triggers>
                <Trigger Property="IsFocused" Value="True">
                    <Setter Property="BorderBrush" Value="#4299E1"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Style cho ComboBox -->
        <Style x:Key="ModernComboBox" TargetType="ComboBox">
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="BorderBrush" Value="#B3D4E5"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Foreground" Value="#2C5282"/>
        </Style>

        <!-- Style cho CheckBox -->
        <Style x:Key="ModernCheckBox" TargetType="CheckBox">
            <Setter Property="Foreground" Value="#2C5282"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>

        <!-- Style cho Label -->
        <Style x:Key="FieldLabel" TargetType="Label">
            <Setter Property="Foreground" Value="#2D3748"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
        </Style>

        <!-- Style cho TabControl -->
        <Style x:Key="ModernTabControl" TargetType="TabControl">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>

        <Style x:Key="ModernTabItem" TargetType="TabItem">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TabItem">
                        <Border Name="Border" 
                                Background="#E6F7FF" 
                                BorderThickness="0"
                                CornerRadius="8,8,0,0"
                                Margin="0,0,4,0"
                                Padding="20,12">
                            <ContentPresenter x:Name="ContentSite"
                                            ContentSource="Header"
                                            VerticalAlignment="Center"
                                            HorizontalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#4299E1"/>
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="False">
                                <Setter Property="Foreground" Value="#2C5282"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#BEE3F8"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Style cho DataGrid -->
        <Style x:Key="ModernDataGrid" TargetType="DataGrid">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#B3D4E5"/>
            <Setter Property="BorderThickness" Value="2"/>
            <Setter Property="GridLinesVisibility" Value="None"/>
            <Setter Property="AlternatingRowBackground" Value="#EBF8FF"/>
            <Setter Property="RowBackground" Value="White"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="HeadersVisibility" Value="Column"/>
            <Setter Property="RowHeight" Value="50"/>
        </Style>

        <Style x:Key="DataGridColumnHeader" TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="#2C5282"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Padding" Value="12,10"/>
            <Setter Property="BorderThickness" Value="0,0,1,0"/>
            <Setter Property="BorderBrush" Value="#4299E1"/>
        </Style>

        <Style TargetType="DataGridCell">
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#BEE3F8"/>
                    <Setter Property="Foreground" Value="#1A365D"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="DataGridRow">
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#E6F7FF"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Style cho Expander -->
        <Style x:Key="ModernExpander" TargetType="Expander">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#B3D4E5"/>
            <Setter Property="BorderThickness" Value="2"/>
        </Style>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" 
                Background="#2C5282" 
                CornerRadius="10,10,0,0" 
                Padding="25,18" 
                Margin="0,0,0,15">
            <Grid>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="🎓" FontSize="32" Margin="0,0,15,0"/>
                    <StackPanel>
                        <TextBlock Text="Student Portal" 
                                  FontSize="26" 
                                  FontWeight="Bold" 
                                  Foreground="White"/>
                        <TextBlock Text="Search books and view your borrowing history" 
                                  FontSize="13" 
                                  Foreground="#B3D4E5" 
                                  Margin="0,5,0,0"/>
                    </StackPanel>
                </StackPanel>
            </Grid>
        </Border>

        <!-- TabControl -->
        <TabControl Grid.Row="1" Style="{StaticResource ModernTabControl}">
            <TabItem Header="🔍 Tìm sách" Style="{StaticResource ModernTabItem}">
                <Border Background="White" 
                        CornerRadius="0,10,10,10" 
                        Padding="20">
                    <Border.Effect>
                        <DropShadowEffect Color="#90CDF4" Opacity="0.3" BlurRadius="15" ShadowDepth="0"/>
                    </Border.Effect>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="15"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Search + Paging Controls -->
                        <Border Grid.Row="0" 
                                Background="#EBF8FF" 
                                CornerRadius="8" 
                                Padding="15" 
                                Margin="0,0,0,12">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Search section -->
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <Label Content="Tìm kiếm:" Style="{StaticResource FieldLabel}" VerticalAlignment="Center"/>
                                    <TextBox x:Name="txtSearch" 
                                            Width="300" 
                                            Margin="8,0"
                                            Style="{StaticResource ModernTextBox}"/>
                                    <Label Content="Theo:" Style="{StaticResource FieldLabel}" VerticalAlignment="Center" Margin="12,0,0,0"/>
                                    <ComboBox x:Name="cboCriteria" 
                                             Width="120" 
                                             Margin="8,0"
                                             Style="{StaticResource ModernComboBox}">
                                        <ComboBoxItem Content="Title" IsSelected="True"/>
                                        <ComboBoxItem Content="Author"/>
                                        <ComboBoxItem Content="Category"/>
                                    </ComboBox>
                                    <Button x:Name="btnSearch" 
                                           Content="🔍 Tìm" 
                                           Width="100" 
                                           Margin="12,0,0,0" 
                                           Click="BtnSearch_Click"
                                           Style="{StaticResource PrimaryButton}"/>
                                </StackPanel>

                                <!-- Paging section -->
                                <StackPanel Grid.Column="1" 
                                           Orientation="Horizontal" 
                                           VerticalAlignment="Center">
                                    <Border Background="White" 
                                            CornerRadius="6" 
                                            Padding="12,6" 
                                            Margin="0,0,12,0">
                                        <StackPanel Orientation="Horizontal">
                                            <Label Content="Số dòng:" Style="{StaticResource FieldLabel}" VerticalAlignment="Center"/>
                                            <ComboBox x:Name="cboPageSize" 
                                                     Width="70" 
                                                     Margin="6,0"
                                                     Style="{StaticResource ModernComboBox}"
                                                     SelectionChanged="CboPageSize_SelectionChanged">
                                                <ComboBoxItem Content="5"/>
                                                <ComboBoxItem Content="10" IsSelected="True"/>
                                                <ComboBoxItem Content="20"/>
                                                <ComboBoxItem Content="50"/>
                                            </ComboBox>
                                        </StackPanel>
                                    </Border>

                                    <Button x:Name="btnPrevPage" 
                                           Content="◀" 
                                           Width="40" 
                                           Click="BtnPrevPage_Click"
                                           Style="{StaticResource IconButton}"/>
                                    <Border Background="White" 
                                            CornerRadius="6" 
                                            Padding="12,6" 
                                            Margin="8">
                                        <TextBlock x:Name="lblPageInfo" 
                                                  VerticalAlignment="Center" 
                                                  Text="Trang 0/0"
                                                  FontWeight="SemiBold"
                                                  Foreground="#2C5282"/>
                                    </Border>
                                    <Button x:Name="btnNextPage" 
                                           Content="▶" 
                                           Width="40" 
                                           Click="BtnNextPage_Click"
                                           Style="{StaticResource IconButton}"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Advanced Filters -->
                        <Expander Header="🔧 Bộ lọc nâng cao" 
                                 Grid.Row="1" 
                                 IsExpanded="False" 
                                 Margin="0,0,0,8"
                                 Style="{StaticResource ModernExpander}"
                                 Padding="15">
                            <Border Background="#F7FAFC" 
                                    CornerRadius="6" 
                                    Padding="15" 
                                    Margin="0,10,0,0">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="12"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <Label Content="Tác giả:" Style="{StaticResource FieldLabel}" VerticalAlignment="Center"/>
                                        <ComboBox x:Name="cboFilterAuthor" 
                                                 Width="180" 
                                                 Margin="6,0"
                                                 Style="{StaticResource ModernComboBox}"/>
                                        <Label Content="Thể loại:" Style="{StaticResource FieldLabel}" VerticalAlignment="Center" Margin="12,0,0,0"/>
                                        <ComboBox x:Name="cboFilterCategory" 
                                                 Width="160" 
                                                 Margin="6,0"
                                                 Style="{StaticResource ModernComboBox}"/>
                                    </StackPanel>

                                    <StackPanel Grid.Row="2" 
                                               Orientation="Horizontal" 
                                               VerticalAlignment="Center">
                                        <Label Content="Năm xuất bản:" Style="{StaticResource FieldLabel}" VerticalAlignment="Center"/>
                                        <TextBox x:Name="txtYearFrom" 
                                                Width="80" 
                                                Margin="6,0" 
                                                ToolTip="Từ năm"
                                                Style="{StaticResource ModernTextBox}"/>
                                        <Label Content="—" VerticalAlignment="Center" Margin="4,0"/>
                                        <TextBox x:Name="txtYearTo" 
                                                Width="80" 
                                                Margin="4,0" 
                                                ToolTip="Đến năm"
                                                Style="{StaticResource ModernTextBox}"/>
                                        <CheckBox x:Name="chkAvailableOnly" 
                                                 Content="✓ Chỉ sách còn sẵn" 
                                                 Margin="20,0"
                                                 Style="{StaticResource ModernCheckBox}"/>
                                        <Button x:Name="btnClearFilters" 
                                               Content="🗑️ Xóa bộ lọc" 
                                               Width="120" 
                                               Margin="12,0" 
                                               Click="BtnClearFilters_Click"
                                               Style="{StaticResource PrimaryButton}"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </Expander>

                        <!-- Results DataGrid -->
                        <DataGrid x:Name="dgBooks" 
                                 Grid.Row="3" 
                                 AutoGenerateColumns="False" 
                                 IsReadOnly="True" 
                                 CanUserAddRows="False"
                                 Style="{StaticResource ModernDataGrid}"
                                 ColumnHeaderStyle="{StaticResource DataGridColumnHeader}">
                            <DataGrid.Columns>
                                <DataGridTemplateColumn Header="📸 Cover" Width="90">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border CornerRadius="4" 
                                                   Margin="5"
                                                   BorderThickness="1"
                                                   BorderBrush="#B3D4E5">
                                                <Image Source="{Binding CoverImagePath}" 
                                                      Width="55" 
                                                      Height="75" 
                                                      Stretch="UniformToFill"/>
                                            </Border>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>

                                <DataGridTextColumn Header="📖 Title" Binding="{Binding Title}" Width="2*"/>
                                <DataGridTextColumn Header="✍️ Author" Binding="{Binding Author}" Width="*"/>
                                <DataGridTextColumn Header="📅 Year" Binding="{Binding PublishYear}" Width="100"/>
                                <DataGridTextColumn Header="📂 Category" Binding="{Binding Category}" Width="130"/>
                                <DataGridTextColumn Header="📦 Total" Binding="{Binding Quantity}" Width="80"/>
                                <DataGridTextColumn Header="✅ Available" Binding="{Binding AvailableCount}" Width="90"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </Border>
            </TabItem>

            <TabItem Header="📚 Lịch sử mượn" Style="{StaticResource ModernTabItem}">
                <Border Background="White" 
                        CornerRadius="0,10,10,10" 
                        Padding="20">
                    <Border.Effect>
                        <DropShadowEffect Color="#90CDF4" Opacity="0.3" BlurRadius="15" ShadowDepth="0"/>
                    </Border.Effect>
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="15"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Border Grid.Row="0" 
                                Background="#EBF8FF" 
                                CornerRadius="8" 
                                Padding="15">
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <Button x:Name="btnLoadHistory" 
                                       Content="🔄 Tải lịch sử" 
                                       Width="140" 
                                       Click="BtnLoadHistory_Click"
                                       Style="{StaticResource PrimaryButton}"/>
                                <Border Background="White" 
                                       CornerRadius="6" 
                                       Padding="15,8" 
                                       Margin="20,0,0,0">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="👤" FontSize="16" Margin="0,0,8,0"/>
                                        <TextBlock x:Name="lblStudentName" 
                                                  VerticalAlignment="Center" 
                                                  FontWeight="Bold"
                                                  FontSize="14"
                                                  Foreground="#2C5282"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </Border>

                        <DataGrid x:Name="dgHistory" 
                                 Grid.Row="2" 
                                 AutoGenerateColumns="False" 
                                 IsReadOnly="True"
                                 Style="{StaticResource ModernDataGrid}"
                                 ColumnHeaderStyle="{StaticResource DataGridColumnHeader}">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="📅 Ngày mượn" Binding="{Binding BorrowDate}" Width="130"/>
                                <DataGridTextColumn Header="📅 Ngày trả" Binding="{Binding ReturnDate}" Width="130"/>
                                <DataGridTextColumn Header="📊 Trạng thái" Binding="{Binding Status}" Width="120"/>
                                <DataGridTextColumn Header="📖 Tên sách" Binding="{Binding BookTitle}" Width="2*"/>
                                <DataGridTextColumn Header="🔢 ID" Binding="{Binding InstanceId}" Width="100"/>
                                <DataGridTextColumn Header="👨‍💼 Thủ thư" Binding="{Binding LibrarianName}" Width="150"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </Border>
            </TabItem>
        </TabControl>

        <!-- Floating AI Chat Button -->
        <Button x:Name="btnChatAI"
                Content="💬 Trợ lý AI"
                Width="140"
                Height="50"
                HorizontalAlignment="Right"
                VerticalAlignment="Bottom"
                Margin="0,0,30,30"
                Click="BtnChatAI_Click"
                Style="{StaticResource FloatingButton}"
                Padding="15,10"/>
    </Grid>
</Window>